{"ast":null,"code":"'use strict';\n\nvar defaults = require('./core.defaults');\n\nvar Element = require('./core.element');\n\nvar helpers = require('../helpers/index');\n\ndefaults._set('global', {\n  tooltips: {\n    enabled: true,\n    custom: null,\n    mode: 'nearest',\n    position: 'average',\n    intersect: true,\n    backgroundColor: 'rgba(0,0,0,0.8)',\n    titleFontStyle: 'bold',\n    titleSpacing: 2,\n    titleMarginBottom: 6,\n    titleFontColor: '#fff',\n    titleAlign: 'left',\n    bodySpacing: 2,\n    bodyFontColor: '#fff',\n    bodyAlign: 'left',\n    footerFontStyle: 'bold',\n    footerSpacing: 2,\n    footerMarginTop: 6,\n    footerFontColor: '#fff',\n    footerAlign: 'left',\n    yPadding: 6,\n    xPadding: 6,\n    caretPadding: 2,\n    caretSize: 5,\n    cornerRadius: 6,\n    multiKeyBackground: '#fff',\n    displayColors: true,\n    borderColor: 'rgba(0,0,0,0)',\n    borderWidth: 0,\n    callbacks: {\n      // Args are: (tooltipItems, data)\n      beforeTitle: helpers.noop,\n      title: function (tooltipItems, data) {\n        // Pick first xLabel for now\n        var title = '';\n        var labels = data.labels;\n        var labelCount = labels ? labels.length : 0;\n\n        if (tooltipItems.length > 0) {\n          var item = tooltipItems[0];\n\n          if (item.xLabel) {\n            title = item.xLabel;\n          } else if (labelCount > 0 && item.index < labelCount) {\n            title = labels[item.index];\n          }\n        }\n\n        return title;\n      },\n      afterTitle: helpers.noop,\n      // Args are: (tooltipItems, data)\n      beforeBody: helpers.noop,\n      // Args are: (tooltipItem, data)\n      beforeLabel: helpers.noop,\n      label: function (tooltipItem, data) {\n        var label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n        if (label) {\n          label += ': ';\n        }\n\n        label += tooltipItem.yLabel;\n        return label;\n      },\n      labelColor: function (tooltipItem, chart) {\n        var meta = chart.getDatasetMeta(tooltipItem.datasetIndex);\n        var activeElement = meta.data[tooltipItem.index];\n        var view = activeElement._view;\n        return {\n          borderColor: view.borderColor,\n          backgroundColor: view.backgroundColor\n        };\n      },\n      labelTextColor: function () {\n        return this._options.bodyFontColor;\n      },\n      afterLabel: helpers.noop,\n      // Args are: (tooltipItems, data)\n      afterBody: helpers.noop,\n      // Args are: (tooltipItems, data)\n      beforeFooter: helpers.noop,\n      footer: helpers.noop,\n      afterFooter: helpers.noop\n    }\n  }\n});\n\nvar positioners = {\n  /**\n   * Average mode places the tooltip at the average position of the elements shown\n   * @function Chart.Tooltip.positioners.average\n   * @param elements {ChartElement[]} the elements being displayed in the tooltip\n   * @returns {Point} tooltip position\n   */\n  average: function (elements) {\n    if (!elements.length) {\n      return false;\n    }\n\n    var i, len;\n    var x = 0;\n    var y = 0;\n    var count = 0;\n\n    for (i = 0, len = elements.length; i < len; ++i) {\n      var el = elements[i];\n\n      if (el && el.hasValue()) {\n        var pos = el.tooltipPosition();\n        x += pos.x;\n        y += pos.y;\n        ++count;\n      }\n    }\n\n    return {\n      x: Math.round(x / count),\n      y: Math.round(y / count)\n    };\n  },\n\n  /**\n   * Gets the tooltip position nearest of the item nearest to the event position\n   * @function Chart.Tooltip.positioners.nearest\n   * @param elements {Chart.Element[]} the tooltip elements\n   * @param eventPosition {Point} the position of the event in canvas coordinates\n   * @returns {Point} the tooltip position\n   */\n  nearest: function (elements, eventPosition) {\n    var x = eventPosition.x;\n    var y = eventPosition.y;\n    var minDistance = Number.POSITIVE_INFINITY;\n    var i, len, nearestElement;\n\n    for (i = 0, len = elements.length; i < len; ++i) {\n      var el = elements[i];\n\n      if (el && el.hasValue()) {\n        var center = el.getCenterPoint();\n        var d = helpers.distanceBetweenPoints(eventPosition, center);\n\n        if (d < minDistance) {\n          minDistance = d;\n          nearestElement = el;\n        }\n      }\n    }\n\n    if (nearestElement) {\n      var tp = nearestElement.tooltipPosition();\n      x = tp.x;\n      y = tp.y;\n    }\n\n    return {\n      x: x,\n      y: y\n    };\n  }\n};\n/**\n * Helper method to merge the opacity into a color\n */\n\nfunction mergeOpacity(colorString, opacity) {\n  var color = helpers.color(colorString);\n  return color.alpha(opacity * color.alpha()).rgbaString();\n} // Helper to push or concat based on if the 2nd parameter is an array or not\n\n\nfunction pushOrConcat(base, toPush) {\n  if (toPush) {\n    if (helpers.isArray(toPush)) {\n      // base = base.concat(toPush);\n      Array.prototype.push.apply(base, toPush);\n    } else {\n      base.push(toPush);\n    }\n  }\n\n  return base;\n}\n/**\n * Returns array of strings split by newline\n * @param {String} value - The value to split by newline.\n * @returns {Array} value if newline present - Returned from String split() method\n * @function\n */\n\n\nfunction splitNewlines(str) {\n  if ((typeof str === 'string' || str instanceof String) && str.indexOf('\\n') > -1) {\n    return str.split('\\n');\n  }\n\n  return str;\n} // Private helper to create a tooltip item model\n// @param element : the chart element (point, arc, bar) to create the tooltip item for\n// @return : new tooltip item\n\n\nfunction createTooltipItem(element) {\n  var xScale = element._xScale;\n  var yScale = element._yScale || element._scale; // handle radar || polarArea charts\n\n  var index = element._index;\n  var datasetIndex = element._datasetIndex;\n  return {\n    xLabel: xScale ? xScale.getLabelForIndex(index, datasetIndex) : '',\n    yLabel: yScale ? yScale.getLabelForIndex(index, datasetIndex) : '',\n    index: index,\n    datasetIndex: datasetIndex,\n    x: element._model.x,\n    y: element._model.y\n  };\n}\n/**\n * Helper to get the reset model for the tooltip\n * @param tooltipOpts {Object} the tooltip options\n */\n\n\nfunction getBaseModel(tooltipOpts) {\n  var globalDefaults = defaults.global;\n  var valueOrDefault = helpers.valueOrDefault;\n  return {\n    // Positioning\n    xPadding: tooltipOpts.xPadding,\n    yPadding: tooltipOpts.yPadding,\n    xAlign: tooltipOpts.xAlign,\n    yAlign: tooltipOpts.yAlign,\n    // Body\n    bodyFontColor: tooltipOpts.bodyFontColor,\n    _bodyFontFamily: valueOrDefault(tooltipOpts.bodyFontFamily, globalDefaults.defaultFontFamily),\n    _bodyFontStyle: valueOrDefault(tooltipOpts.bodyFontStyle, globalDefaults.defaultFontStyle),\n    _bodyAlign: tooltipOpts.bodyAlign,\n    bodyFontSize: valueOrDefault(tooltipOpts.bodyFontSize, globalDefaults.defaultFontSize),\n    bodySpacing: tooltipOpts.bodySpacing,\n    // Title\n    titleFontColor: tooltipOpts.titleFontColor,\n    _titleFontFamily: valueOrDefault(tooltipOpts.titleFontFamily, globalDefaults.defaultFontFamily),\n    _titleFontStyle: valueOrDefault(tooltipOpts.titleFontStyle, globalDefaults.defaultFontStyle),\n    titleFontSize: valueOrDefault(tooltipOpts.titleFontSize, globalDefaults.defaultFontSize),\n    _titleAlign: tooltipOpts.titleAlign,\n    titleSpacing: tooltipOpts.titleSpacing,\n    titleMarginBottom: tooltipOpts.titleMarginBottom,\n    // Footer\n    footerFontColor: tooltipOpts.footerFontColor,\n    _footerFontFamily: valueOrDefault(tooltipOpts.footerFontFamily, globalDefaults.defaultFontFamily),\n    _footerFontStyle: valueOrDefault(tooltipOpts.footerFontStyle, globalDefaults.defaultFontStyle),\n    footerFontSize: valueOrDefault(tooltipOpts.footerFontSize, globalDefaults.defaultFontSize),\n    _footerAlign: tooltipOpts.footerAlign,\n    footerSpacing: tooltipOpts.footerSpacing,\n    footerMarginTop: tooltipOpts.footerMarginTop,\n    // Appearance\n    caretSize: tooltipOpts.caretSize,\n    cornerRadius: tooltipOpts.cornerRadius,\n    backgroundColor: tooltipOpts.backgroundColor,\n    opacity: 0,\n    legendColorBackground: tooltipOpts.multiKeyBackground,\n    displayColors: tooltipOpts.displayColors,\n    borderColor: tooltipOpts.borderColor,\n    borderWidth: tooltipOpts.borderWidth\n  };\n}\n/**\n * Get the size of the tooltip\n */\n\n\nfunction getTooltipSize(tooltip, model) {\n  var ctx = tooltip._chart.ctx;\n  var height = model.yPadding * 2; // Tooltip Padding\n\n  var width = 0; // Count of all lines in the body\n\n  var body = model.body;\n  var combinedBodyLength = body.reduce(function (count, bodyItem) {\n    return count + bodyItem.before.length + bodyItem.lines.length + bodyItem.after.length;\n  }, 0);\n  combinedBodyLength += model.beforeBody.length + model.afterBody.length;\n  var titleLineCount = model.title.length;\n  var footerLineCount = model.footer.length;\n  var titleFontSize = model.titleFontSize;\n  var bodyFontSize = model.bodyFontSize;\n  var footerFontSize = model.footerFontSize;\n  height += titleLineCount * titleFontSize; // Title Lines\n\n  height += titleLineCount ? (titleLineCount - 1) * model.titleSpacing : 0; // Title Line Spacing\n\n  height += titleLineCount ? model.titleMarginBottom : 0; // Title's bottom Margin\n\n  height += combinedBodyLength * bodyFontSize; // Body Lines\n\n  height += combinedBodyLength ? (combinedBodyLength - 1) * model.bodySpacing : 0; // Body Line Spacing\n\n  height += footerLineCount ? model.footerMarginTop : 0; // Footer Margin\n\n  height += footerLineCount * footerFontSize; // Footer Lines\n\n  height += footerLineCount ? (footerLineCount - 1) * model.footerSpacing : 0; // Footer Line Spacing\n  // Title width\n\n  var widthPadding = 0;\n\n  var maxLineWidth = function (line) {\n    width = Math.max(width, ctx.measureText(line).width + widthPadding);\n  };\n\n  ctx.font = helpers.fontString(titleFontSize, model._titleFontStyle, model._titleFontFamily);\n  helpers.each(model.title, maxLineWidth); // Body width\n\n  ctx.font = helpers.fontString(bodyFontSize, model._bodyFontStyle, model._bodyFontFamily);\n  helpers.each(model.beforeBody.concat(model.afterBody), maxLineWidth); // Body lines may include some extra width due to the color box\n\n  widthPadding = model.displayColors ? bodyFontSize + 2 : 0;\n  helpers.each(body, function (bodyItem) {\n    helpers.each(bodyItem.before, maxLineWidth);\n    helpers.each(bodyItem.lines, maxLineWidth);\n    helpers.each(bodyItem.after, maxLineWidth);\n  }); // Reset back to 0\n\n  widthPadding = 0; // Footer width\n\n  ctx.font = helpers.fontString(footerFontSize, model._footerFontStyle, model._footerFontFamily);\n  helpers.each(model.footer, maxLineWidth); // Add padding\n\n  width += 2 * model.xPadding;\n  return {\n    width: width,\n    height: height\n  };\n}\n/**\n * Helper to get the alignment of a tooltip given the size\n */\n\n\nfunction determineAlignment(tooltip, size) {\n  var model = tooltip._model;\n  var chart = tooltip._chart;\n  var chartArea = tooltip._chart.chartArea;\n  var xAlign = 'center';\n  var yAlign = 'center';\n\n  if (model.y < size.height) {\n    yAlign = 'top';\n  } else if (model.y > chart.height - size.height) {\n    yAlign = 'bottom';\n  }\n\n  var lf, rf; // functions to determine left, right alignment\n\n  var olf, orf; // functions to determine if left/right alignment causes tooltip to go outside chart\n\n  var yf; // function to get the y alignment if the tooltip goes outside of the left or right edges\n\n  var midX = (chartArea.left + chartArea.right) / 2;\n  var midY = (chartArea.top + chartArea.bottom) / 2;\n\n  if (yAlign === 'center') {\n    lf = function (x) {\n      return x <= midX;\n    };\n\n    rf = function (x) {\n      return x > midX;\n    };\n  } else {\n    lf = function (x) {\n      return x <= size.width / 2;\n    };\n\n    rf = function (x) {\n      return x >= chart.width - size.width / 2;\n    };\n  }\n\n  olf = function (x) {\n    return x + size.width + model.caretSize + model.caretPadding > chart.width;\n  };\n\n  orf = function (x) {\n    return x - size.width - model.caretSize - model.caretPadding < 0;\n  };\n\n  yf = function (y) {\n    return y <= midY ? 'top' : 'bottom';\n  };\n\n  if (lf(model.x)) {\n    xAlign = 'left'; // Is tooltip too wide and goes over the right side of the chart.?\n\n    if (olf(model.x)) {\n      xAlign = 'center';\n      yAlign = yf(model.y);\n    }\n  } else if (rf(model.x)) {\n    xAlign = 'right'; // Is tooltip too wide and goes outside left edge of canvas?\n\n    if (orf(model.x)) {\n      xAlign = 'center';\n      yAlign = yf(model.y);\n    }\n  }\n\n  var opts = tooltip._options;\n  return {\n    xAlign: opts.xAlign ? opts.xAlign : xAlign,\n    yAlign: opts.yAlign ? opts.yAlign : yAlign\n  };\n}\n/**\n * Helper to get the location a tooltip needs to be placed at given the initial position (via the vm) and the size and alignment\n */\n\n\nfunction getBackgroundPoint(vm, size, alignment, chart) {\n  // Background Position\n  var x = vm.x;\n  var y = vm.y;\n  var caretSize = vm.caretSize;\n  var caretPadding = vm.caretPadding;\n  var cornerRadius = vm.cornerRadius;\n  var xAlign = alignment.xAlign;\n  var yAlign = alignment.yAlign;\n  var paddingAndSize = caretSize + caretPadding;\n  var radiusAndPadding = cornerRadius + caretPadding;\n\n  if (xAlign === 'right') {\n    x -= size.width;\n  } else if (xAlign === 'center') {\n    x -= size.width / 2;\n\n    if (x + size.width > chart.width) {\n      x = chart.width - size.width;\n    }\n\n    if (x < 0) {\n      x = 0;\n    }\n  }\n\n  if (yAlign === 'top') {\n    y += paddingAndSize;\n  } else if (yAlign === 'bottom') {\n    y -= size.height + paddingAndSize;\n  } else {\n    y -= size.height / 2;\n  }\n\n  if (yAlign === 'center') {\n    if (xAlign === 'left') {\n      x += paddingAndSize;\n    } else if (xAlign === 'right') {\n      x -= paddingAndSize;\n    }\n  } else if (xAlign === 'left') {\n    x -= radiusAndPadding;\n  } else if (xAlign === 'right') {\n    x += radiusAndPadding;\n  }\n\n  return {\n    x: x,\n    y: y\n  };\n}\n/**\n * Helper to build before and after body lines\n */\n\n\nfunction getBeforeAfterBodyLines(callback) {\n  return pushOrConcat([], splitNewlines(callback));\n}\n\nvar exports = module.exports = Element.extend({\n  initialize: function () {\n    this._model = getBaseModel(this._options);\n    this._lastActive = [];\n  },\n  // Get the title\n  // Args are: (tooltipItem, data)\n  getTitle: function () {\n    var me = this;\n    var opts = me._options;\n    var callbacks = opts.callbacks;\n    var beforeTitle = callbacks.beforeTitle.apply(me, arguments);\n    var title = callbacks.title.apply(me, arguments);\n    var afterTitle = callbacks.afterTitle.apply(me, arguments);\n    var lines = [];\n    lines = pushOrConcat(lines, splitNewlines(beforeTitle));\n    lines = pushOrConcat(lines, splitNewlines(title));\n    lines = pushOrConcat(lines, splitNewlines(afterTitle));\n    return lines;\n  },\n  // Args are: (tooltipItem, data)\n  getBeforeBody: function () {\n    return getBeforeAfterBodyLines(this._options.callbacks.beforeBody.apply(this, arguments));\n  },\n  // Args are: (tooltipItem, data)\n  getBody: function (tooltipItems, data) {\n    var me = this;\n    var callbacks = me._options.callbacks;\n    var bodyItems = [];\n    helpers.each(tooltipItems, function (tooltipItem) {\n      var bodyItem = {\n        before: [],\n        lines: [],\n        after: []\n      };\n      pushOrConcat(bodyItem.before, splitNewlines(callbacks.beforeLabel.call(me, tooltipItem, data)));\n      pushOrConcat(bodyItem.lines, callbacks.label.call(me, tooltipItem, data));\n      pushOrConcat(bodyItem.after, splitNewlines(callbacks.afterLabel.call(me, tooltipItem, data)));\n      bodyItems.push(bodyItem);\n    });\n    return bodyItems;\n  },\n  // Args are: (tooltipItem, data)\n  getAfterBody: function () {\n    return getBeforeAfterBodyLines(this._options.callbacks.afterBody.apply(this, arguments));\n  },\n  // Get the footer and beforeFooter and afterFooter lines\n  // Args are: (tooltipItem, data)\n  getFooter: function () {\n    var me = this;\n    var callbacks = me._options.callbacks;\n    var beforeFooter = callbacks.beforeFooter.apply(me, arguments);\n    var footer = callbacks.footer.apply(me, arguments);\n    var afterFooter = callbacks.afterFooter.apply(me, arguments);\n    var lines = [];\n    lines = pushOrConcat(lines, splitNewlines(beforeFooter));\n    lines = pushOrConcat(lines, splitNewlines(footer));\n    lines = pushOrConcat(lines, splitNewlines(afterFooter));\n    return lines;\n  },\n  update: function (changed) {\n    var me = this;\n    var opts = me._options; // Need to regenerate the model because its faster than using extend and it is necessary due to the optimization in Chart.Element.transition\n    // that does _view = _model if ease === 1. This causes the 2nd tooltip update to set properties in both the view and model at the same time\n    // which breaks any animations.\n\n    var existingModel = me._model;\n    var model = me._model = getBaseModel(opts);\n    var active = me._active;\n    var data = me._data; // In the case where active.length === 0 we need to keep these at existing values for good animations\n\n    var alignment = {\n      xAlign: existingModel.xAlign,\n      yAlign: existingModel.yAlign\n    };\n    var backgroundPoint = {\n      x: existingModel.x,\n      y: existingModel.y\n    };\n    var tooltipSize = {\n      width: existingModel.width,\n      height: existingModel.height\n    };\n    var tooltipPosition = {\n      x: existingModel.caretX,\n      y: existingModel.caretY\n    };\n    var i, len;\n\n    if (active.length) {\n      model.opacity = 1;\n      var labelColors = [];\n      var labelTextColors = [];\n      tooltipPosition = positioners[opts.position].call(me, active, me._eventPosition);\n      var tooltipItems = [];\n\n      for (i = 0, len = active.length; i < len; ++i) {\n        tooltipItems.push(createTooltipItem(active[i]));\n      } // If the user provided a filter function, use it to modify the tooltip items\n\n\n      if (opts.filter) {\n        tooltipItems = tooltipItems.filter(function (a) {\n          return opts.filter(a, data);\n        });\n      } // If the user provided a sorting function, use it to modify the tooltip items\n\n\n      if (opts.itemSort) {\n        tooltipItems = tooltipItems.sort(function (a, b) {\n          return opts.itemSort(a, b, data);\n        });\n      } // Determine colors for boxes\n\n\n      helpers.each(tooltipItems, function (tooltipItem) {\n        labelColors.push(opts.callbacks.labelColor.call(me, tooltipItem, me._chart));\n        labelTextColors.push(opts.callbacks.labelTextColor.call(me, tooltipItem, me._chart));\n      }); // Build the Text Lines\n\n      model.title = me.getTitle(tooltipItems, data);\n      model.beforeBody = me.getBeforeBody(tooltipItems, data);\n      model.body = me.getBody(tooltipItems, data);\n      model.afterBody = me.getAfterBody(tooltipItems, data);\n      model.footer = me.getFooter(tooltipItems, data); // Initial positioning and colors\n\n      model.x = Math.round(tooltipPosition.x);\n      model.y = Math.round(tooltipPosition.y);\n      model.caretPadding = opts.caretPadding;\n      model.labelColors = labelColors;\n      model.labelTextColors = labelTextColors; // data points\n\n      model.dataPoints = tooltipItems; // We need to determine alignment of the tooltip\n\n      tooltipSize = getTooltipSize(this, model);\n      alignment = determineAlignment(this, tooltipSize); // Final Size and Position\n\n      backgroundPoint = getBackgroundPoint(model, tooltipSize, alignment, me._chart);\n    } else {\n      model.opacity = 0;\n    }\n\n    model.xAlign = alignment.xAlign;\n    model.yAlign = alignment.yAlign;\n    model.x = backgroundPoint.x;\n    model.y = backgroundPoint.y;\n    model.width = tooltipSize.width;\n    model.height = tooltipSize.height; // Point where the caret on the tooltip points to\n\n    model.caretX = tooltipPosition.x;\n    model.caretY = tooltipPosition.y;\n    me._model = model;\n\n    if (changed && opts.custom) {\n      opts.custom.call(me, model);\n    }\n\n    return me;\n  },\n  drawCaret: function (tooltipPoint, size) {\n    var ctx = this._chart.ctx;\n    var vm = this._view;\n    var caretPosition = this.getCaretPosition(tooltipPoint, size, vm);\n    ctx.lineTo(caretPosition.x1, caretPosition.y1);\n    ctx.lineTo(caretPosition.x2, caretPosition.y2);\n    ctx.lineTo(caretPosition.x3, caretPosition.y3);\n  },\n  getCaretPosition: function (tooltipPoint, size, vm) {\n    var x1, x2, x3, y1, y2, y3;\n    var caretSize = vm.caretSize;\n    var cornerRadius = vm.cornerRadius;\n    var xAlign = vm.xAlign;\n    var yAlign = vm.yAlign;\n    var ptX = tooltipPoint.x;\n    var ptY = tooltipPoint.y;\n    var width = size.width;\n    var height = size.height;\n\n    if (yAlign === 'center') {\n      y2 = ptY + height / 2;\n\n      if (xAlign === 'left') {\n        x1 = ptX;\n        x2 = x1 - caretSize;\n        x3 = x1;\n        y1 = y2 + caretSize;\n        y3 = y2 - caretSize;\n      } else {\n        x1 = ptX + width;\n        x2 = x1 + caretSize;\n        x3 = x1;\n        y1 = y2 - caretSize;\n        y3 = y2 + caretSize;\n      }\n    } else {\n      if (xAlign === 'left') {\n        x2 = ptX + cornerRadius + caretSize;\n        x1 = x2 - caretSize;\n        x3 = x2 + caretSize;\n      } else if (xAlign === 'right') {\n        x2 = ptX + width - cornerRadius - caretSize;\n        x1 = x2 - caretSize;\n        x3 = x2 + caretSize;\n      } else {\n        x2 = vm.caretX;\n        x1 = x2 - caretSize;\n        x3 = x2 + caretSize;\n      }\n\n      if (yAlign === 'top') {\n        y1 = ptY;\n        y2 = y1 - caretSize;\n        y3 = y1;\n      } else {\n        y1 = ptY + height;\n        y2 = y1 + caretSize;\n        y3 = y1; // invert drawing order\n\n        var tmp = x3;\n        x3 = x1;\n        x1 = tmp;\n      }\n    }\n\n    return {\n      x1: x1,\n      x2: x2,\n      x3: x3,\n      y1: y1,\n      y2: y2,\n      y3: y3\n    };\n  },\n  drawTitle: function (pt, vm, ctx, opacity) {\n    var title = vm.title;\n\n    if (title.length) {\n      ctx.textAlign = vm._titleAlign;\n      ctx.textBaseline = 'top';\n      var titleFontSize = vm.titleFontSize;\n      var titleSpacing = vm.titleSpacing;\n      ctx.fillStyle = mergeOpacity(vm.titleFontColor, opacity);\n      ctx.font = helpers.fontString(titleFontSize, vm._titleFontStyle, vm._titleFontFamily);\n      var i, len;\n\n      for (i = 0, len = title.length; i < len; ++i) {\n        ctx.fillText(title[i], pt.x, pt.y);\n        pt.y += titleFontSize + titleSpacing; // Line Height and spacing\n\n        if (i + 1 === title.length) {\n          pt.y += vm.titleMarginBottom - titleSpacing; // If Last, add margin, remove spacing\n        }\n      }\n    }\n  },\n  drawBody: function (pt, vm, ctx, opacity) {\n    var bodyFontSize = vm.bodyFontSize;\n    var bodySpacing = vm.bodySpacing;\n    var body = vm.body;\n    ctx.textAlign = vm._bodyAlign;\n    ctx.textBaseline = 'top';\n    ctx.font = helpers.fontString(bodyFontSize, vm._bodyFontStyle, vm._bodyFontFamily); // Before Body\n\n    var xLinePadding = 0;\n\n    var fillLineOfText = function (line) {\n      ctx.fillText(line, pt.x + xLinePadding, pt.y);\n      pt.y += bodyFontSize + bodySpacing;\n    }; // Before body lines\n\n\n    ctx.fillStyle = mergeOpacity(vm.bodyFontColor, opacity);\n    helpers.each(vm.beforeBody, fillLineOfText);\n    var drawColorBoxes = vm.displayColors;\n    xLinePadding = drawColorBoxes ? bodyFontSize + 2 : 0; // Draw body lines now\n\n    helpers.each(body, function (bodyItem, i) {\n      var textColor = mergeOpacity(vm.labelTextColors[i], opacity);\n      ctx.fillStyle = textColor;\n      helpers.each(bodyItem.before, fillLineOfText);\n      helpers.each(bodyItem.lines, function (line) {\n        // Draw Legend-like boxes if needed\n        if (drawColorBoxes) {\n          // Fill a white rect so that colours merge nicely if the opacity is < 1\n          ctx.fillStyle = mergeOpacity(vm.legendColorBackground, opacity);\n          ctx.fillRect(pt.x, pt.y, bodyFontSize, bodyFontSize); // Border\n\n          ctx.lineWidth = 1;\n          ctx.strokeStyle = mergeOpacity(vm.labelColors[i].borderColor, opacity);\n          ctx.strokeRect(pt.x, pt.y, bodyFontSize, bodyFontSize); // Inner square\n\n          ctx.fillStyle = mergeOpacity(vm.labelColors[i].backgroundColor, opacity);\n          ctx.fillRect(pt.x + 1, pt.y + 1, bodyFontSize - 2, bodyFontSize - 2);\n          ctx.fillStyle = textColor;\n        }\n\n        fillLineOfText(line);\n      });\n      helpers.each(bodyItem.after, fillLineOfText);\n    }); // Reset back to 0 for after body\n\n    xLinePadding = 0; // After body lines\n\n    helpers.each(vm.afterBody, fillLineOfText);\n    pt.y -= bodySpacing; // Remove last body spacing\n  },\n  drawFooter: function (pt, vm, ctx, opacity) {\n    var footer = vm.footer;\n\n    if (footer.length) {\n      pt.y += vm.footerMarginTop;\n      ctx.textAlign = vm._footerAlign;\n      ctx.textBaseline = 'top';\n      ctx.fillStyle = mergeOpacity(vm.footerFontColor, opacity);\n      ctx.font = helpers.fontString(vm.footerFontSize, vm._footerFontStyle, vm._footerFontFamily);\n      helpers.each(footer, function (line) {\n        ctx.fillText(line, pt.x, pt.y);\n        pt.y += vm.footerFontSize + vm.footerSpacing;\n      });\n    }\n  },\n  drawBackground: function (pt, vm, ctx, tooltipSize, opacity) {\n    ctx.fillStyle = mergeOpacity(vm.backgroundColor, opacity);\n    ctx.strokeStyle = mergeOpacity(vm.borderColor, opacity);\n    ctx.lineWidth = vm.borderWidth;\n    var xAlign = vm.xAlign;\n    var yAlign = vm.yAlign;\n    var x = pt.x;\n    var y = pt.y;\n    var width = tooltipSize.width;\n    var height = tooltipSize.height;\n    var radius = vm.cornerRadius;\n    ctx.beginPath();\n    ctx.moveTo(x + radius, y);\n\n    if (yAlign === 'top') {\n      this.drawCaret(pt, tooltipSize);\n    }\n\n    ctx.lineTo(x + width - radius, y);\n    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n\n    if (yAlign === 'center' && xAlign === 'right') {\n      this.drawCaret(pt, tooltipSize);\n    }\n\n    ctx.lineTo(x + width, y + height - radius);\n    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n\n    if (yAlign === 'bottom') {\n      this.drawCaret(pt, tooltipSize);\n    }\n\n    ctx.lineTo(x + radius, y + height);\n    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n\n    if (yAlign === 'center' && xAlign === 'left') {\n      this.drawCaret(pt, tooltipSize);\n    }\n\n    ctx.lineTo(x, y + radius);\n    ctx.quadraticCurveTo(x, y, x + radius, y);\n    ctx.closePath();\n    ctx.fill();\n\n    if (vm.borderWidth > 0) {\n      ctx.stroke();\n    }\n  },\n  draw: function () {\n    var ctx = this._chart.ctx;\n    var vm = this._view;\n\n    if (vm.opacity === 0) {\n      return;\n    }\n\n    var tooltipSize = {\n      width: vm.width,\n      height: vm.height\n    };\n    var pt = {\n      x: vm.x,\n      y: vm.y\n    }; // IE11/Edge does not like very small opacities, so snap to 0\n\n    var opacity = Math.abs(vm.opacity < 1e-3) ? 0 : vm.opacity; // Truthy/falsey value for empty tooltip\n\n    var hasTooltipContent = vm.title.length || vm.beforeBody.length || vm.body.length || vm.afterBody.length || vm.footer.length;\n\n    if (this._options.enabled && hasTooltipContent) {\n      // Draw Background\n      this.drawBackground(pt, vm, ctx, tooltipSize, opacity); // Draw Title, Body, and Footer\n\n      pt.x += vm.xPadding;\n      pt.y += vm.yPadding; // Titles\n\n      this.drawTitle(pt, vm, ctx, opacity); // Body\n\n      this.drawBody(pt, vm, ctx, opacity); // Footer\n\n      this.drawFooter(pt, vm, ctx, opacity);\n    }\n  },\n\n  /**\n   * Handle an event\n   * @private\n   * @param {IEvent} event - The event to handle\n   * @returns {Boolean} true if the tooltip changed\n   */\n  handleEvent: function (e) {\n    var me = this;\n    var options = me._options;\n    var changed = false;\n    me._lastActive = me._lastActive || []; // Find Active Elements for tooltips\n\n    if (e.type === 'mouseout') {\n      me._active = [];\n    } else {\n      me._active = me._chart.getElementsAtEventForMode(e, options.mode, options);\n    } // Remember Last Actives\n\n\n    changed = !helpers.arrayEquals(me._active, me._lastActive); // Only handle target event on tooltip change\n\n    if (changed) {\n      me._lastActive = me._active;\n\n      if (options.enabled || options.custom) {\n        me._eventPosition = {\n          x: e.x,\n          y: e.y\n        };\n        me.update(true);\n        me.pivot();\n      }\n    }\n\n    return changed;\n  }\n});\n/**\n * @namespace Chart.Tooltip.positioners\n */\n\nexports.positioners = positioners;","map":{"version":3,"sources":["C:/Users/Administrator/.git/asdf/Source Files/node_modules/chart.js/src/core/core.tooltip.js"],"names":["defaults","require","Element","helpers","_set","tooltips","enabled","custom","mode","position","intersect","backgroundColor","titleFontStyle","titleSpacing","titleMarginBottom","titleFontColor","titleAlign","bodySpacing","bodyFontColor","bodyAlign","footerFontStyle","footerSpacing","footerMarginTop","footerFontColor","footerAlign","yPadding","xPadding","caretPadding","caretSize","cornerRadius","multiKeyBackground","displayColors","borderColor","borderWidth","callbacks","beforeTitle","noop","title","tooltipItems","data","labels","labelCount","length","item","xLabel","index","afterTitle","beforeBody","beforeLabel","label","tooltipItem","datasets","datasetIndex","yLabel","labelColor","chart","meta","getDatasetMeta","activeElement","view","_view","labelTextColor","_options","afterLabel","afterBody","beforeFooter","footer","afterFooter","positioners","average","elements","i","len","x","y","count","el","hasValue","pos","tooltipPosition","Math","round","nearest","eventPosition","minDistance","Number","POSITIVE_INFINITY","nearestElement","center","getCenterPoint","d","distanceBetweenPoints","tp","mergeOpacity","colorString","opacity","color","alpha","rgbaString","pushOrConcat","base","toPush","isArray","Array","prototype","push","apply","splitNewlines","str","String","indexOf","split","createTooltipItem","element","xScale","_xScale","yScale","_yScale","_scale","_index","_datasetIndex","getLabelForIndex","_model","getBaseModel","tooltipOpts","globalDefaults","global","valueOrDefault","xAlign","yAlign","_bodyFontFamily","bodyFontFamily","defaultFontFamily","_bodyFontStyle","bodyFontStyle","defaultFontStyle","_bodyAlign","bodyFontSize","defaultFontSize","_titleFontFamily","titleFontFamily","_titleFontStyle","titleFontSize","_titleAlign","_footerFontFamily","footerFontFamily","_footerFontStyle","footerFontSize","_footerAlign","legendColorBackground","getTooltipSize","tooltip","model","ctx","_chart","height","width","body","combinedBodyLength","reduce","bodyItem","before","lines","after","titleLineCount","footerLineCount","widthPadding","maxLineWidth","line","max","measureText","font","fontString","each","concat","determineAlignment","size","chartArea","lf","rf","olf","orf","yf","midX","left","right","midY","top","bottom","opts","getBackgroundPoint","vm","alignment","paddingAndSize","radiusAndPadding","getBeforeAfterBodyLines","callback","exports","module","extend","initialize","_lastActive","getTitle","me","arguments","getBeforeBody","getBody","bodyItems","call","getAfterBody","getFooter","update","changed","existingModel","active","_active","_data","backgroundPoint","tooltipSize","caretX","caretY","labelColors","labelTextColors","_eventPosition","filter","a","itemSort","sort","b","dataPoints","drawCaret","tooltipPoint","caretPosition","getCaretPosition","lineTo","x1","y1","x2","y2","x3","y3","ptX","ptY","tmp","drawTitle","pt","textAlign","textBaseline","fillStyle","fillText","drawBody","xLinePadding","fillLineOfText","drawColorBoxes","textColor","fillRect","lineWidth","strokeStyle","strokeRect","drawFooter","drawBackground","radius","beginPath","moveTo","quadraticCurveTo","closePath","fill","stroke","draw","abs","hasTooltipContent","handleEvent","e","options","type","getElementsAtEventForMode","arrayEquals","pivot"],"mappings":"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","sourcesContent":["'use strict';\n\nvar defaults = require('./core.defaults');\nvar Element = require('./core.element');\nvar helpers = require('../helpers/index');\n\ndefaults._set('global', {\n\ttooltips: {\n\t\tenabled: true,\n\t\tcustom: null,\n\t\tmode: 'nearest',\n\t\tposition: 'average',\n\t\tintersect: true,\n\t\tbackgroundColor: 'rgba(0,0,0,0.8)',\n\t\ttitleFontStyle: 'bold',\n\t\ttitleSpacing: 2,\n\t\ttitleMarginBottom: 6,\n\t\ttitleFontColor: '#fff',\n\t\ttitleAlign: 'left',\n\t\tbodySpacing: 2,\n\t\tbodyFontColor: '#fff',\n\t\tbodyAlign: 'left',\n\t\tfooterFontStyle: 'bold',\n\t\tfooterSpacing: 2,\n\t\tfooterMarginTop: 6,\n\t\tfooterFontColor: '#fff',\n\t\tfooterAlign: 'left',\n\t\tyPadding: 6,\n\t\txPadding: 6,\n\t\tcaretPadding: 2,\n\t\tcaretSize: 5,\n\t\tcornerRadius: 6,\n\t\tmultiKeyBackground: '#fff',\n\t\tdisplayColors: true,\n\t\tborderColor: 'rgba(0,0,0,0)',\n\t\tborderWidth: 0,\n\t\tcallbacks: {\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tbeforeTitle: helpers.noop,\n\t\t\ttitle: function(tooltipItems, data) {\n\t\t\t\t// Pick first xLabel for now\n\t\t\t\tvar title = '';\n\t\t\t\tvar labels = data.labels;\n\t\t\t\tvar labelCount = labels ? labels.length : 0;\n\n\t\t\t\tif (tooltipItems.length > 0) {\n\t\t\t\t\tvar item = tooltipItems[0];\n\n\t\t\t\t\tif (item.xLabel) {\n\t\t\t\t\t\ttitle = item.xLabel;\n\t\t\t\t\t} else if (labelCount > 0 && item.index < labelCount) {\n\t\t\t\t\t\ttitle = labels[item.index];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn title;\n\t\t\t},\n\t\t\tafterTitle: helpers.noop,\n\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tbeforeBody: helpers.noop,\n\n\t\t\t// Args are: (tooltipItem, data)\n\t\t\tbeforeLabel: helpers.noop,\n\t\t\tlabel: function(tooltipItem, data) {\n\t\t\t\tvar label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n\t\t\t\tif (label) {\n\t\t\t\t\tlabel += ': ';\n\t\t\t\t}\n\t\t\t\tlabel += tooltipItem.yLabel;\n\t\t\t\treturn label;\n\t\t\t},\n\t\t\tlabelColor: function(tooltipItem, chart) {\n\t\t\t\tvar meta = chart.getDatasetMeta(tooltipItem.datasetIndex);\n\t\t\t\tvar activeElement = meta.data[tooltipItem.index];\n\t\t\t\tvar view = activeElement._view;\n\t\t\t\treturn {\n\t\t\t\t\tborderColor: view.borderColor,\n\t\t\t\t\tbackgroundColor: view.backgroundColor\n\t\t\t\t};\n\t\t\t},\n\t\t\tlabelTextColor: function() {\n\t\t\t\treturn this._options.bodyFontColor;\n\t\t\t},\n\t\t\tafterLabel: helpers.noop,\n\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tafterBody: helpers.noop,\n\n\t\t\t// Args are: (tooltipItems, data)\n\t\t\tbeforeFooter: helpers.noop,\n\t\t\tfooter: helpers.noop,\n\t\t\tafterFooter: helpers.noop\n\t\t}\n\t}\n});\n\nvar positioners = {\n\t/**\n\t * Average mode places the tooltip at the average position of the elements shown\n\t * @function Chart.Tooltip.positioners.average\n\t * @param elements {ChartElement[]} the elements being displayed in the tooltip\n\t * @returns {Point} tooltip position\n\t */\n\taverage: function(elements) {\n\t\tif (!elements.length) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar i, len;\n\t\tvar x = 0;\n\t\tvar y = 0;\n\t\tvar count = 0;\n\n\t\tfor (i = 0, len = elements.length; i < len; ++i) {\n\t\t\tvar el = elements[i];\n\t\t\tif (el && el.hasValue()) {\n\t\t\t\tvar pos = el.tooltipPosition();\n\t\t\t\tx += pos.x;\n\t\t\t\ty += pos.y;\n\t\t\t\t++count;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tx: Math.round(x / count),\n\t\t\ty: Math.round(y / count)\n\t\t};\n\t},\n\n\t/**\n\t * Gets the tooltip position nearest of the item nearest to the event position\n\t * @function Chart.Tooltip.positioners.nearest\n\t * @param elements {Chart.Element[]} the tooltip elements\n\t * @param eventPosition {Point} the position of the event in canvas coordinates\n\t * @returns {Point} the tooltip position\n\t */\n\tnearest: function(elements, eventPosition) {\n\t\tvar x = eventPosition.x;\n\t\tvar y = eventPosition.y;\n\t\tvar minDistance = Number.POSITIVE_INFINITY;\n\t\tvar i, len, nearestElement;\n\n\t\tfor (i = 0, len = elements.length; i < len; ++i) {\n\t\t\tvar el = elements[i];\n\t\t\tif (el && el.hasValue()) {\n\t\t\t\tvar center = el.getCenterPoint();\n\t\t\t\tvar d = helpers.distanceBetweenPoints(eventPosition, center);\n\n\t\t\t\tif (d < minDistance) {\n\t\t\t\t\tminDistance = d;\n\t\t\t\t\tnearestElement = el;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (nearestElement) {\n\t\t\tvar tp = nearestElement.tooltipPosition();\n\t\t\tx = tp.x;\n\t\t\ty = tp.y;\n\t\t}\n\n\t\treturn {\n\t\t\tx: x,\n\t\t\ty: y\n\t\t};\n\t}\n};\n\n/**\n * Helper method to merge the opacity into a color\n */\nfunction mergeOpacity(colorString, opacity) {\n\tvar color = helpers.color(colorString);\n\treturn color.alpha(opacity * color.alpha()).rgbaString();\n}\n\n// Helper to push or concat based on if the 2nd parameter is an array or not\nfunction pushOrConcat(base, toPush) {\n\tif (toPush) {\n\t\tif (helpers.isArray(toPush)) {\n\t\t\t// base = base.concat(toPush);\n\t\t\tArray.prototype.push.apply(base, toPush);\n\t\t} else {\n\t\t\tbase.push(toPush);\n\t\t}\n\t}\n\n\treturn base;\n}\n\n/**\n * Returns array of strings split by newline\n * @param {String} value - The value to split by newline.\n * @returns {Array} value if newline present - Returned from String split() method\n * @function\n */\nfunction splitNewlines(str) {\n\tif ((typeof str === 'string' || str instanceof String) && str.indexOf('\\n') > -1) {\n\t\treturn str.split('\\n');\n\t}\n\treturn str;\n}\n\n\n// Private helper to create a tooltip item model\n// @param element : the chart element (point, arc, bar) to create the tooltip item for\n// @return : new tooltip item\nfunction createTooltipItem(element) {\n\tvar xScale = element._xScale;\n\tvar yScale = element._yScale || element._scale; // handle radar || polarArea charts\n\tvar index = element._index;\n\tvar datasetIndex = element._datasetIndex;\n\n\treturn {\n\t\txLabel: xScale ? xScale.getLabelForIndex(index, datasetIndex) : '',\n\t\tyLabel: yScale ? yScale.getLabelForIndex(index, datasetIndex) : '',\n\t\tindex: index,\n\t\tdatasetIndex: datasetIndex,\n\t\tx: element._model.x,\n\t\ty: element._model.y\n\t};\n}\n\n/**\n * Helper to get the reset model for the tooltip\n * @param tooltipOpts {Object} the tooltip options\n */\nfunction getBaseModel(tooltipOpts) {\n\tvar globalDefaults = defaults.global;\n\tvar valueOrDefault = helpers.valueOrDefault;\n\n\treturn {\n\t\t// Positioning\n\t\txPadding: tooltipOpts.xPadding,\n\t\tyPadding: tooltipOpts.yPadding,\n\t\txAlign: tooltipOpts.xAlign,\n\t\tyAlign: tooltipOpts.yAlign,\n\n\t\t// Body\n\t\tbodyFontColor: tooltipOpts.bodyFontColor,\n\t\t_bodyFontFamily: valueOrDefault(tooltipOpts.bodyFontFamily, globalDefaults.defaultFontFamily),\n\t\t_bodyFontStyle: valueOrDefault(tooltipOpts.bodyFontStyle, globalDefaults.defaultFontStyle),\n\t\t_bodyAlign: tooltipOpts.bodyAlign,\n\t\tbodyFontSize: valueOrDefault(tooltipOpts.bodyFontSize, globalDefaults.defaultFontSize),\n\t\tbodySpacing: tooltipOpts.bodySpacing,\n\n\t\t// Title\n\t\ttitleFontColor: tooltipOpts.titleFontColor,\n\t\t_titleFontFamily: valueOrDefault(tooltipOpts.titleFontFamily, globalDefaults.defaultFontFamily),\n\t\t_titleFontStyle: valueOrDefault(tooltipOpts.titleFontStyle, globalDefaults.defaultFontStyle),\n\t\ttitleFontSize: valueOrDefault(tooltipOpts.titleFontSize, globalDefaults.defaultFontSize),\n\t\t_titleAlign: tooltipOpts.titleAlign,\n\t\ttitleSpacing: tooltipOpts.titleSpacing,\n\t\ttitleMarginBottom: tooltipOpts.titleMarginBottom,\n\n\t\t// Footer\n\t\tfooterFontColor: tooltipOpts.footerFontColor,\n\t\t_footerFontFamily: valueOrDefault(tooltipOpts.footerFontFamily, globalDefaults.defaultFontFamily),\n\t\t_footerFontStyle: valueOrDefault(tooltipOpts.footerFontStyle, globalDefaults.defaultFontStyle),\n\t\tfooterFontSize: valueOrDefault(tooltipOpts.footerFontSize, globalDefaults.defaultFontSize),\n\t\t_footerAlign: tooltipOpts.footerAlign,\n\t\tfooterSpacing: tooltipOpts.footerSpacing,\n\t\tfooterMarginTop: tooltipOpts.footerMarginTop,\n\n\t\t// Appearance\n\t\tcaretSize: tooltipOpts.caretSize,\n\t\tcornerRadius: tooltipOpts.cornerRadius,\n\t\tbackgroundColor: tooltipOpts.backgroundColor,\n\t\topacity: 0,\n\t\tlegendColorBackground: tooltipOpts.multiKeyBackground,\n\t\tdisplayColors: tooltipOpts.displayColors,\n\t\tborderColor: tooltipOpts.borderColor,\n\t\tborderWidth: tooltipOpts.borderWidth\n\t};\n}\n\n/**\n * Get the size of the tooltip\n */\nfunction getTooltipSize(tooltip, model) {\n\tvar ctx = tooltip._chart.ctx;\n\n\tvar height = model.yPadding * 2; // Tooltip Padding\n\tvar width = 0;\n\n\t// Count of all lines in the body\n\tvar body = model.body;\n\tvar combinedBodyLength = body.reduce(function(count, bodyItem) {\n\t\treturn count + bodyItem.before.length + bodyItem.lines.length + bodyItem.after.length;\n\t}, 0);\n\tcombinedBodyLength += model.beforeBody.length + model.afterBody.length;\n\n\tvar titleLineCount = model.title.length;\n\tvar footerLineCount = model.footer.length;\n\tvar titleFontSize = model.titleFontSize;\n\tvar bodyFontSize = model.bodyFontSize;\n\tvar footerFontSize = model.footerFontSize;\n\n\theight += titleLineCount * titleFontSize; // Title Lines\n\theight += titleLineCount ? (titleLineCount - 1) * model.titleSpacing : 0; // Title Line Spacing\n\theight += titleLineCount ? model.titleMarginBottom : 0; // Title's bottom Margin\n\theight += combinedBodyLength * bodyFontSize; // Body Lines\n\theight += combinedBodyLength ? (combinedBodyLength - 1) * model.bodySpacing : 0; // Body Line Spacing\n\theight += footerLineCount ? model.footerMarginTop : 0; // Footer Margin\n\theight += footerLineCount * (footerFontSize); // Footer Lines\n\theight += footerLineCount ? (footerLineCount - 1) * model.footerSpacing : 0; // Footer Line Spacing\n\n\t// Title width\n\tvar widthPadding = 0;\n\tvar maxLineWidth = function(line) {\n\t\twidth = Math.max(width, ctx.measureText(line).width + widthPadding);\n\t};\n\n\tctx.font = helpers.fontString(titleFontSize, model._titleFontStyle, model._titleFontFamily);\n\thelpers.each(model.title, maxLineWidth);\n\n\t// Body width\n\tctx.font = helpers.fontString(bodyFontSize, model._bodyFontStyle, model._bodyFontFamily);\n\thelpers.each(model.beforeBody.concat(model.afterBody), maxLineWidth);\n\n\t// Body lines may include some extra width due to the color box\n\twidthPadding = model.displayColors ? (bodyFontSize + 2) : 0;\n\thelpers.each(body, function(bodyItem) {\n\t\thelpers.each(bodyItem.before, maxLineWidth);\n\t\thelpers.each(bodyItem.lines, maxLineWidth);\n\t\thelpers.each(bodyItem.after, maxLineWidth);\n\t});\n\n\t// Reset back to 0\n\twidthPadding = 0;\n\n\t// Footer width\n\tctx.font = helpers.fontString(footerFontSize, model._footerFontStyle, model._footerFontFamily);\n\thelpers.each(model.footer, maxLineWidth);\n\n\t// Add padding\n\twidth += 2 * model.xPadding;\n\n\treturn {\n\t\twidth: width,\n\t\theight: height\n\t};\n}\n\n/**\n * Helper to get the alignment of a tooltip given the size\n */\nfunction determineAlignment(tooltip, size) {\n\tvar model = tooltip._model;\n\tvar chart = tooltip._chart;\n\tvar chartArea = tooltip._chart.chartArea;\n\tvar xAlign = 'center';\n\tvar yAlign = 'center';\n\n\tif (model.y < size.height) {\n\t\tyAlign = 'top';\n\t} else if (model.y > (chart.height - size.height)) {\n\t\tyAlign = 'bottom';\n\t}\n\n\tvar lf, rf; // functions to determine left, right alignment\n\tvar olf, orf; // functions to determine if left/right alignment causes tooltip to go outside chart\n\tvar yf; // function to get the y alignment if the tooltip goes outside of the left or right edges\n\tvar midX = (chartArea.left + chartArea.right) / 2;\n\tvar midY = (chartArea.top + chartArea.bottom) / 2;\n\n\tif (yAlign === 'center') {\n\t\tlf = function(x) {\n\t\t\treturn x <= midX;\n\t\t};\n\t\trf = function(x) {\n\t\t\treturn x > midX;\n\t\t};\n\t} else {\n\t\tlf = function(x) {\n\t\t\treturn x <= (size.width / 2);\n\t\t};\n\t\trf = function(x) {\n\t\t\treturn x >= (chart.width - (size.width / 2));\n\t\t};\n\t}\n\n\tolf = function(x) {\n\t\treturn x + size.width + model.caretSize + model.caretPadding > chart.width;\n\t};\n\torf = function(x) {\n\t\treturn x - size.width - model.caretSize - model.caretPadding < 0;\n\t};\n\tyf = function(y) {\n\t\treturn y <= midY ? 'top' : 'bottom';\n\t};\n\n\tif (lf(model.x)) {\n\t\txAlign = 'left';\n\n\t\t// Is tooltip too wide and goes over the right side of the chart.?\n\t\tif (olf(model.x)) {\n\t\t\txAlign = 'center';\n\t\t\tyAlign = yf(model.y);\n\t\t}\n\t} else if (rf(model.x)) {\n\t\txAlign = 'right';\n\n\t\t// Is tooltip too wide and goes outside left edge of canvas?\n\t\tif (orf(model.x)) {\n\t\t\txAlign = 'center';\n\t\t\tyAlign = yf(model.y);\n\t\t}\n\t}\n\n\tvar opts = tooltip._options;\n\treturn {\n\t\txAlign: opts.xAlign ? opts.xAlign : xAlign,\n\t\tyAlign: opts.yAlign ? opts.yAlign : yAlign\n\t};\n}\n\n/**\n * Helper to get the location a tooltip needs to be placed at given the initial position (via the vm) and the size and alignment\n */\nfunction getBackgroundPoint(vm, size, alignment, chart) {\n\t// Background Position\n\tvar x = vm.x;\n\tvar y = vm.y;\n\n\tvar caretSize = vm.caretSize;\n\tvar caretPadding = vm.caretPadding;\n\tvar cornerRadius = vm.cornerRadius;\n\tvar xAlign = alignment.xAlign;\n\tvar yAlign = alignment.yAlign;\n\tvar paddingAndSize = caretSize + caretPadding;\n\tvar radiusAndPadding = cornerRadius + caretPadding;\n\n\tif (xAlign === 'right') {\n\t\tx -= size.width;\n\t} else if (xAlign === 'center') {\n\t\tx -= (size.width / 2);\n\t\tif (x + size.width > chart.width) {\n\t\t\tx = chart.width - size.width;\n\t\t}\n\t\tif (x < 0) {\n\t\t\tx = 0;\n\t\t}\n\t}\n\n\tif (yAlign === 'top') {\n\t\ty += paddingAndSize;\n\t} else if (yAlign === 'bottom') {\n\t\ty -= size.height + paddingAndSize;\n\t} else {\n\t\ty -= (size.height / 2);\n\t}\n\n\tif (yAlign === 'center') {\n\t\tif (xAlign === 'left') {\n\t\t\tx += paddingAndSize;\n\t\t} else if (xAlign === 'right') {\n\t\t\tx -= paddingAndSize;\n\t\t}\n\t} else if (xAlign === 'left') {\n\t\tx -= radiusAndPadding;\n\t} else if (xAlign === 'right') {\n\t\tx += radiusAndPadding;\n\t}\n\n\treturn {\n\t\tx: x,\n\t\ty: y\n\t};\n}\n\n/**\n * Helper to build before and after body lines\n */\nfunction getBeforeAfterBodyLines(callback) {\n\treturn pushOrConcat([], splitNewlines(callback));\n}\n\nvar exports = module.exports = Element.extend({\n\tinitialize: function() {\n\t\tthis._model = getBaseModel(this._options);\n\t\tthis._lastActive = [];\n\t},\n\n\t// Get the title\n\t// Args are: (tooltipItem, data)\n\tgetTitle: function() {\n\t\tvar me = this;\n\t\tvar opts = me._options;\n\t\tvar callbacks = opts.callbacks;\n\n\t\tvar beforeTitle = callbacks.beforeTitle.apply(me, arguments);\n\t\tvar title = callbacks.title.apply(me, arguments);\n\t\tvar afterTitle = callbacks.afterTitle.apply(me, arguments);\n\n\t\tvar lines = [];\n\t\tlines = pushOrConcat(lines, splitNewlines(beforeTitle));\n\t\tlines = pushOrConcat(lines, splitNewlines(title));\n\t\tlines = pushOrConcat(lines, splitNewlines(afterTitle));\n\n\t\treturn lines;\n\t},\n\n\t// Args are: (tooltipItem, data)\n\tgetBeforeBody: function() {\n\t\treturn getBeforeAfterBodyLines(this._options.callbacks.beforeBody.apply(this, arguments));\n\t},\n\n\t// Args are: (tooltipItem, data)\n\tgetBody: function(tooltipItems, data) {\n\t\tvar me = this;\n\t\tvar callbacks = me._options.callbacks;\n\t\tvar bodyItems = [];\n\n\t\thelpers.each(tooltipItems, function(tooltipItem) {\n\t\t\tvar bodyItem = {\n\t\t\t\tbefore: [],\n\t\t\t\tlines: [],\n\t\t\t\tafter: []\n\t\t\t};\n\t\t\tpushOrConcat(bodyItem.before, splitNewlines(callbacks.beforeLabel.call(me, tooltipItem, data)));\n\t\t\tpushOrConcat(bodyItem.lines, callbacks.label.call(me, tooltipItem, data));\n\t\t\tpushOrConcat(bodyItem.after, splitNewlines(callbacks.afterLabel.call(me, tooltipItem, data)));\n\n\t\t\tbodyItems.push(bodyItem);\n\t\t});\n\n\t\treturn bodyItems;\n\t},\n\n\t// Args are: (tooltipItem, data)\n\tgetAfterBody: function() {\n\t\treturn getBeforeAfterBodyLines(this._options.callbacks.afterBody.apply(this, arguments));\n\t},\n\n\t// Get the footer and beforeFooter and afterFooter lines\n\t// Args are: (tooltipItem, data)\n\tgetFooter: function() {\n\t\tvar me = this;\n\t\tvar callbacks = me._options.callbacks;\n\n\t\tvar beforeFooter = callbacks.beforeFooter.apply(me, arguments);\n\t\tvar footer = callbacks.footer.apply(me, arguments);\n\t\tvar afterFooter = callbacks.afterFooter.apply(me, arguments);\n\n\t\tvar lines = [];\n\t\tlines = pushOrConcat(lines, splitNewlines(beforeFooter));\n\t\tlines = pushOrConcat(lines, splitNewlines(footer));\n\t\tlines = pushOrConcat(lines, splitNewlines(afterFooter));\n\n\t\treturn lines;\n\t},\n\n\tupdate: function(changed) {\n\t\tvar me = this;\n\t\tvar opts = me._options;\n\n\t\t// Need to regenerate the model because its faster than using extend and it is necessary due to the optimization in Chart.Element.transition\n\t\t// that does _view = _model if ease === 1. This causes the 2nd tooltip update to set properties in both the view and model at the same time\n\t\t// which breaks any animations.\n\t\tvar existingModel = me._model;\n\t\tvar model = me._model = getBaseModel(opts);\n\t\tvar active = me._active;\n\n\t\tvar data = me._data;\n\n\t\t// In the case where active.length === 0 we need to keep these at existing values for good animations\n\t\tvar alignment = {\n\t\t\txAlign: existingModel.xAlign,\n\t\t\tyAlign: existingModel.yAlign\n\t\t};\n\t\tvar backgroundPoint = {\n\t\t\tx: existingModel.x,\n\t\t\ty: existingModel.y\n\t\t};\n\t\tvar tooltipSize = {\n\t\t\twidth: existingModel.width,\n\t\t\theight: existingModel.height\n\t\t};\n\t\tvar tooltipPosition = {\n\t\t\tx: existingModel.caretX,\n\t\t\ty: existingModel.caretY\n\t\t};\n\n\t\tvar i, len;\n\n\t\tif (active.length) {\n\t\t\tmodel.opacity = 1;\n\n\t\t\tvar labelColors = [];\n\t\t\tvar labelTextColors = [];\n\t\t\ttooltipPosition = positioners[opts.position].call(me, active, me._eventPosition);\n\n\t\t\tvar tooltipItems = [];\n\t\t\tfor (i = 0, len = active.length; i < len; ++i) {\n\t\t\t\ttooltipItems.push(createTooltipItem(active[i]));\n\t\t\t}\n\n\t\t\t// If the user provided a filter function, use it to modify the tooltip items\n\t\t\tif (opts.filter) {\n\t\t\t\ttooltipItems = tooltipItems.filter(function(a) {\n\t\t\t\t\treturn opts.filter(a, data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// If the user provided a sorting function, use it to modify the tooltip items\n\t\t\tif (opts.itemSort) {\n\t\t\t\ttooltipItems = tooltipItems.sort(function(a, b) {\n\t\t\t\t\treturn opts.itemSort(a, b, data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Determine colors for boxes\n\t\t\thelpers.each(tooltipItems, function(tooltipItem) {\n\t\t\t\tlabelColors.push(opts.callbacks.labelColor.call(me, tooltipItem, me._chart));\n\t\t\t\tlabelTextColors.push(opts.callbacks.labelTextColor.call(me, tooltipItem, me._chart));\n\t\t\t});\n\n\n\t\t\t// Build the Text Lines\n\t\t\tmodel.title = me.getTitle(tooltipItems, data);\n\t\t\tmodel.beforeBody = me.getBeforeBody(tooltipItems, data);\n\t\t\tmodel.body = me.getBody(tooltipItems, data);\n\t\t\tmodel.afterBody = me.getAfterBody(tooltipItems, data);\n\t\t\tmodel.footer = me.getFooter(tooltipItems, data);\n\n\t\t\t// Initial positioning and colors\n\t\t\tmodel.x = Math.round(tooltipPosition.x);\n\t\t\tmodel.y = Math.round(tooltipPosition.y);\n\t\t\tmodel.caretPadding = opts.caretPadding;\n\t\t\tmodel.labelColors = labelColors;\n\t\t\tmodel.labelTextColors = labelTextColors;\n\n\t\t\t// data points\n\t\t\tmodel.dataPoints = tooltipItems;\n\n\t\t\t// We need to determine alignment of the tooltip\n\t\t\ttooltipSize = getTooltipSize(this, model);\n\t\t\talignment = determineAlignment(this, tooltipSize);\n\t\t\t// Final Size and Position\n\t\t\tbackgroundPoint = getBackgroundPoint(model, tooltipSize, alignment, me._chart);\n\t\t} else {\n\t\t\tmodel.opacity = 0;\n\t\t}\n\n\t\tmodel.xAlign = alignment.xAlign;\n\t\tmodel.yAlign = alignment.yAlign;\n\t\tmodel.x = backgroundPoint.x;\n\t\tmodel.y = backgroundPoint.y;\n\t\tmodel.width = tooltipSize.width;\n\t\tmodel.height = tooltipSize.height;\n\n\t\t// Point where the caret on the tooltip points to\n\t\tmodel.caretX = tooltipPosition.x;\n\t\tmodel.caretY = tooltipPosition.y;\n\n\t\tme._model = model;\n\n\t\tif (changed && opts.custom) {\n\t\t\topts.custom.call(me, model);\n\t\t}\n\n\t\treturn me;\n\t},\n\n\tdrawCaret: function(tooltipPoint, size) {\n\t\tvar ctx = this._chart.ctx;\n\t\tvar vm = this._view;\n\t\tvar caretPosition = this.getCaretPosition(tooltipPoint, size, vm);\n\n\t\tctx.lineTo(caretPosition.x1, caretPosition.y1);\n\t\tctx.lineTo(caretPosition.x2, caretPosition.y2);\n\t\tctx.lineTo(caretPosition.x3, caretPosition.y3);\n\t},\n\tgetCaretPosition: function(tooltipPoint, size, vm) {\n\t\tvar x1, x2, x3, y1, y2, y3;\n\t\tvar caretSize = vm.caretSize;\n\t\tvar cornerRadius = vm.cornerRadius;\n\t\tvar xAlign = vm.xAlign;\n\t\tvar yAlign = vm.yAlign;\n\t\tvar ptX = tooltipPoint.x;\n\t\tvar ptY = tooltipPoint.y;\n\t\tvar width = size.width;\n\t\tvar height = size.height;\n\n\t\tif (yAlign === 'center') {\n\t\t\ty2 = ptY + (height / 2);\n\n\t\t\tif (xAlign === 'left') {\n\t\t\t\tx1 = ptX;\n\t\t\t\tx2 = x1 - caretSize;\n\t\t\t\tx3 = x1;\n\n\t\t\t\ty1 = y2 + caretSize;\n\t\t\t\ty3 = y2 - caretSize;\n\t\t\t} else {\n\t\t\t\tx1 = ptX + width;\n\t\t\t\tx2 = x1 + caretSize;\n\t\t\t\tx3 = x1;\n\n\t\t\t\ty1 = y2 - caretSize;\n\t\t\t\ty3 = y2 + caretSize;\n\t\t\t}\n\t\t} else {\n\t\t\tif (xAlign === 'left') {\n\t\t\t\tx2 = ptX + cornerRadius + (caretSize);\n\t\t\t\tx1 = x2 - caretSize;\n\t\t\t\tx3 = x2 + caretSize;\n\t\t\t} else if (xAlign === 'right') {\n\t\t\t\tx2 = ptX + width - cornerRadius - caretSize;\n\t\t\t\tx1 = x2 - caretSize;\n\t\t\t\tx3 = x2 + caretSize;\n\t\t\t} else {\n\t\t\t\tx2 = vm.caretX;\n\t\t\t\tx1 = x2 - caretSize;\n\t\t\t\tx3 = x2 + caretSize;\n\t\t\t}\n\t\t\tif (yAlign === 'top') {\n\t\t\t\ty1 = ptY;\n\t\t\t\ty2 = y1 - caretSize;\n\t\t\t\ty3 = y1;\n\t\t\t} else {\n\t\t\t\ty1 = ptY + height;\n\t\t\t\ty2 = y1 + caretSize;\n\t\t\t\ty3 = y1;\n\t\t\t\t// invert drawing order\n\t\t\t\tvar tmp = x3;\n\t\t\t\tx3 = x1;\n\t\t\t\tx1 = tmp;\n\t\t\t}\n\t\t}\n\t\treturn {x1: x1, x2: x2, x3: x3, y1: y1, y2: y2, y3: y3};\n\t},\n\n\tdrawTitle: function(pt, vm, ctx, opacity) {\n\t\tvar title = vm.title;\n\n\t\tif (title.length) {\n\t\t\tctx.textAlign = vm._titleAlign;\n\t\t\tctx.textBaseline = 'top';\n\n\t\t\tvar titleFontSize = vm.titleFontSize;\n\t\t\tvar titleSpacing = vm.titleSpacing;\n\n\t\t\tctx.fillStyle = mergeOpacity(vm.titleFontColor, opacity);\n\t\t\tctx.font = helpers.fontString(titleFontSize, vm._titleFontStyle, vm._titleFontFamily);\n\n\t\t\tvar i, len;\n\t\t\tfor (i = 0, len = title.length; i < len; ++i) {\n\t\t\t\tctx.fillText(title[i], pt.x, pt.y);\n\t\t\t\tpt.y += titleFontSize + titleSpacing; // Line Height and spacing\n\n\t\t\t\tif (i + 1 === title.length) {\n\t\t\t\t\tpt.y += vm.titleMarginBottom - titleSpacing; // If Last, add margin, remove spacing\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tdrawBody: function(pt, vm, ctx, opacity) {\n\t\tvar bodyFontSize = vm.bodyFontSize;\n\t\tvar bodySpacing = vm.bodySpacing;\n\t\tvar body = vm.body;\n\n\t\tctx.textAlign = vm._bodyAlign;\n\t\tctx.textBaseline = 'top';\n\t\tctx.font = helpers.fontString(bodyFontSize, vm._bodyFontStyle, vm._bodyFontFamily);\n\n\t\t// Before Body\n\t\tvar xLinePadding = 0;\n\t\tvar fillLineOfText = function(line) {\n\t\t\tctx.fillText(line, pt.x + xLinePadding, pt.y);\n\t\t\tpt.y += bodyFontSize + bodySpacing;\n\t\t};\n\n\t\t// Before body lines\n\t\tctx.fillStyle = mergeOpacity(vm.bodyFontColor, opacity);\n\t\thelpers.each(vm.beforeBody, fillLineOfText);\n\n\t\tvar drawColorBoxes = vm.displayColors;\n\t\txLinePadding = drawColorBoxes ? (bodyFontSize + 2) : 0;\n\n\t\t// Draw body lines now\n\t\thelpers.each(body, function(bodyItem, i) {\n\t\t\tvar textColor = mergeOpacity(vm.labelTextColors[i], opacity);\n\t\t\tctx.fillStyle = textColor;\n\t\t\thelpers.each(bodyItem.before, fillLineOfText);\n\n\t\t\thelpers.each(bodyItem.lines, function(line) {\n\t\t\t\t// Draw Legend-like boxes if needed\n\t\t\t\tif (drawColorBoxes) {\n\t\t\t\t\t// Fill a white rect so that colours merge nicely if the opacity is < 1\n\t\t\t\t\tctx.fillStyle = mergeOpacity(vm.legendColorBackground, opacity);\n\t\t\t\t\tctx.fillRect(pt.x, pt.y, bodyFontSize, bodyFontSize);\n\n\t\t\t\t\t// Border\n\t\t\t\t\tctx.lineWidth = 1;\n\t\t\t\t\tctx.strokeStyle = mergeOpacity(vm.labelColors[i].borderColor, opacity);\n\t\t\t\t\tctx.strokeRect(pt.x, pt.y, bodyFontSize, bodyFontSize);\n\n\t\t\t\t\t// Inner square\n\t\t\t\t\tctx.fillStyle = mergeOpacity(vm.labelColors[i].backgroundColor, opacity);\n\t\t\t\t\tctx.fillRect(pt.x + 1, pt.y + 1, bodyFontSize - 2, bodyFontSize - 2);\n\t\t\t\t\tctx.fillStyle = textColor;\n\t\t\t\t}\n\n\t\t\t\tfillLineOfText(line);\n\t\t\t});\n\n\t\t\thelpers.each(bodyItem.after, fillLineOfText);\n\t\t});\n\n\t\t// Reset back to 0 for after body\n\t\txLinePadding = 0;\n\n\t\t// After body lines\n\t\thelpers.each(vm.afterBody, fillLineOfText);\n\t\tpt.y -= bodySpacing; // Remove last body spacing\n\t},\n\n\tdrawFooter: function(pt, vm, ctx, opacity) {\n\t\tvar footer = vm.footer;\n\n\t\tif (footer.length) {\n\t\t\tpt.y += vm.footerMarginTop;\n\n\t\t\tctx.textAlign = vm._footerAlign;\n\t\t\tctx.textBaseline = 'top';\n\n\t\t\tctx.fillStyle = mergeOpacity(vm.footerFontColor, opacity);\n\t\t\tctx.font = helpers.fontString(vm.footerFontSize, vm._footerFontStyle, vm._footerFontFamily);\n\n\t\t\thelpers.each(footer, function(line) {\n\t\t\t\tctx.fillText(line, pt.x, pt.y);\n\t\t\t\tpt.y += vm.footerFontSize + vm.footerSpacing;\n\t\t\t});\n\t\t}\n\t},\n\n\tdrawBackground: function(pt, vm, ctx, tooltipSize, opacity) {\n\t\tctx.fillStyle = mergeOpacity(vm.backgroundColor, opacity);\n\t\tctx.strokeStyle = mergeOpacity(vm.borderColor, opacity);\n\t\tctx.lineWidth = vm.borderWidth;\n\t\tvar xAlign = vm.xAlign;\n\t\tvar yAlign = vm.yAlign;\n\t\tvar x = pt.x;\n\t\tvar y = pt.y;\n\t\tvar width = tooltipSize.width;\n\t\tvar height = tooltipSize.height;\n\t\tvar radius = vm.cornerRadius;\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(x + radius, y);\n\t\tif (yAlign === 'top') {\n\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t}\n\t\tctx.lineTo(x + width - radius, y);\n\t\tctx.quadraticCurveTo(x + width, y, x + width, y + radius);\n\t\tif (yAlign === 'center' && xAlign === 'right') {\n\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t}\n\t\tctx.lineTo(x + width, y + height - radius);\n\t\tctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n\t\tif (yAlign === 'bottom') {\n\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t}\n\t\tctx.lineTo(x + radius, y + height);\n\t\tctx.quadraticCurveTo(x, y + height, x, y + height - radius);\n\t\tif (yAlign === 'center' && xAlign === 'left') {\n\t\t\tthis.drawCaret(pt, tooltipSize);\n\t\t}\n\t\tctx.lineTo(x, y + radius);\n\t\tctx.quadraticCurveTo(x, y, x + radius, y);\n\t\tctx.closePath();\n\n\t\tctx.fill();\n\n\t\tif (vm.borderWidth > 0) {\n\t\t\tctx.stroke();\n\t\t}\n\t},\n\n\tdraw: function() {\n\t\tvar ctx = this._chart.ctx;\n\t\tvar vm = this._view;\n\n\t\tif (vm.opacity === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar tooltipSize = {\n\t\t\twidth: vm.width,\n\t\t\theight: vm.height\n\t\t};\n\t\tvar pt = {\n\t\t\tx: vm.x,\n\t\t\ty: vm.y\n\t\t};\n\n\t\t// IE11/Edge does not like very small opacities, so snap to 0\n\t\tvar opacity = Math.abs(vm.opacity < 1e-3) ? 0 : vm.opacity;\n\n\t\t// Truthy/falsey value for empty tooltip\n\t\tvar hasTooltipContent = vm.title.length || vm.beforeBody.length || vm.body.length || vm.afterBody.length || vm.footer.length;\n\n\t\tif (this._options.enabled && hasTooltipContent) {\n\t\t\t// Draw Background\n\t\t\tthis.drawBackground(pt, vm, ctx, tooltipSize, opacity);\n\n\t\t\t// Draw Title, Body, and Footer\n\t\t\tpt.x += vm.xPadding;\n\t\t\tpt.y += vm.yPadding;\n\n\t\t\t// Titles\n\t\t\tthis.drawTitle(pt, vm, ctx, opacity);\n\n\t\t\t// Body\n\t\t\tthis.drawBody(pt, vm, ctx, opacity);\n\n\t\t\t// Footer\n\t\t\tthis.drawFooter(pt, vm, ctx, opacity);\n\t\t}\n\t},\n\n\t/**\n\t * Handle an event\n\t * @private\n\t * @param {IEvent} event - The event to handle\n\t * @returns {Boolean} true if the tooltip changed\n\t */\n\thandleEvent: function(e) {\n\t\tvar me = this;\n\t\tvar options = me._options;\n\t\tvar changed = false;\n\n\t\tme._lastActive = me._lastActive || [];\n\n\t\t// Find Active Elements for tooltips\n\t\tif (e.type === 'mouseout') {\n\t\t\tme._active = [];\n\t\t} else {\n\t\t\tme._active = me._chart.getElementsAtEventForMode(e, options.mode, options);\n\t\t}\n\n\t\t// Remember Last Actives\n\t\tchanged = !helpers.arrayEquals(me._active, me._lastActive);\n\n\t\t// Only handle target event on tooltip change\n\t\tif (changed) {\n\t\t\tme._lastActive = me._active;\n\n\t\t\tif (options.enabled || options.custom) {\n\t\t\t\tme._eventPosition = {\n\t\t\t\t\tx: e.x,\n\t\t\t\t\ty: e.y\n\t\t\t\t};\n\n\t\t\t\tme.update(true);\n\t\t\t\tme.pivot();\n\t\t\t}\n\t\t}\n\n\t\treturn changed;\n\t}\n});\n\n/**\n * @namespace Chart.Tooltip.positioners\n */\nexports.positioners = positioners;\n\n"]},"metadata":{},"sourceType":"script"}